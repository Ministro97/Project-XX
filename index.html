<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApp Biometric Authentication</title>
    <style>
        .ok { color: green; }
        .err { color: red; }
    </style>
</head>
<body>
    <h1>Telegram WebApp Biometric Authentication</h1>
    <div>
        <button id="initBiometric">Initialize Biometric</button>
        <div id="biometricStatus">
            <p>Inited: <span id="bm_inited">false</span></p>
            <p>Available: <span id="bm_available">false</span></p>
            <p>Type: <span id="bm_type"></span></p>
            <p>Access Requested: <span id="bm_access_requested">false</span></p>
            <p>Access Granted: <span id="bm_access_granted">false</span></p>
            <p>Token Saved: <span id="bm_token_saved">false</span></p>
            <p>Device ID: <span id="bm_device_id"></span></p>
        </div>
        <button id="requestAuth">Request Authentication</button>
        <div id="authResult"></div>
        <div id="bm_settings" style="display: none;">
            <p>Biometric settings need to be configured.</p>
        </div>
    </div>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script> 
    
    
    
    const DemoApp = {
    biometricInited: false,
    showAlert: function(message) {
        alert(message);
    }
};

document.getElementById('initBiometric').addEventListener('click', function() {
    biometricInit(this);
});

document.getElementById('requestAuth').addEventListener('click', function() {
    biometricRequestAuth(this);
});

function biometricInit(el) {
    const biometricManager = Telegram.WebApp.BiometricManager;
    if (!DemoApp.biometricInited) {
        DemoApp.biometricInited = true;
        Telegram.WebApp.onEvent('biometricManagerUpdated', function() {
            document.getElementById('bm_inited').textContent = biometricManager.isInited ? 'true' : 'false';
            document.getElementById('bm_available').textContent = biometricManager.isBiometricAvailable ? 'true' : 'false';
            document.getElementById('bm_type').textContent = biometricManager.biometricType || '';
            document.getElementById('bm_access_requested').textContent = biometricManager.isAccessRequested ? 'true' : 'false';
            document.getElementById('bm_access_granted').textContent = biometricManager.isAccessGranted ? 'true' : 'false';
            document.getElementById('bm_token_saved').textContent = biometricManager.isBiometricTokenSaved ? 'true' : 'false';
            document.getElementById('bm_device_id').textContent = biometricManager.deviceId || '';
            document.getElementById('bm_settings').style.display = biometricManager.isBiometricAvailable && biometricManager.isAccessRequested && !biometricManager.isAccessGranted ? 'block' : 'none';
        });
    }
}

function biometricRequestAuth(el) {
    const biometricManager = Telegram.WebApp.BiometricManager;
    if (!biometricManager.isInited) {
        return DemoApp.showAlert('Biometric not inited yet!');
    }

    el.nextElementSibling.innerHTML = '';
    el.nextElementSibling.classList.remove('ok', 'err');

    biometricManager.authenticate({reason: 'The bot requests biometrics for testing purposes.'}, function(success, token) {
        if (success) {
            el.nextElementSibling.innerHTML = '(Success, token: ' + token + ')';
            el.nextElementSibling.className = 'ok';
        } else {
            el.nextElementSibling.innerHTML = '(Failed)';
            el.nextElementSibling.className = 'err';
        }
    });
}
        
    
    
    
    
    
    
    
    
    </script>
</body>
</html>
